<!DOCTYPE html>
<html lang="th">
<head>
  <link rel="manifest" href="/manifest-electric.json">
  <meta charset="UTF-8" />
  <title>‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</title>
  <style>
    body{font-family:'Kanit',sans-serif;background:#f1f5f9;margin:0;padding:20px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:8px;flex-wrap:wrap}
    h2{margin:0}
    .btn{padding:10px 14px;border-radius:8px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;font-weight:600}
    .btn.link{color:#15563b;border-color:#15563b}
    .search{padding:10px;width:300px;border-radius:8px;border:1px solid #ccc;font-size:16px}
    table{width:100%;border-collapse:collapse;background:#fff;box-shadow:0 0 8px rgba(0,0,0,.1)}
    th,td{padding:10px;border:1px solid #ddd;text-align:center;vertical-align:middle}
    th{background:#15563b;color:#fff}
    .media-container{display:flex;flex-direction:column;align-items:center;gap:10px;padding:10px 0}
    a.map-link{color:#2563eb;font-weight:bold;text-decoration:none}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  </style>
</head>
<body>
  <header>
    <h2>‚úÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á ‚Äî ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (‡πÑ‡∏ü‡∏ü‡πâ‡∏≤)</h2>
    <div class="toolbar">
      <input id="searchInput" class="search" placeholder="üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå..." oninput="applyFilters()" />
      <button class="btn link" onclick="location.href='admin-electric.html'">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</button>
      <button class="btn" onclick="location.href='pending-electric.html'">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</button>
      <button class="btn" onclick="location.href='inprogress-electric.html'">‚öôÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</button>
    </div>
  </header>

  <table>
    <thead>
      <tr>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
        <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th>
        <th>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</th>
        <th>‡πÑ‡∏ü‡∏•‡πå</th>
        <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</th>
        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤</th>
        <th>‡πÑ‡∏ü‡∏•‡πå(‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô)</th>
      </tr>
    </thead>
    <tbody id="data-body"></tbody>
  </table>

  <!-- üî¢ ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤ -->
  <div id="pagination"
       style="margin-top:10px; display:flex; justify-content:center; align-items:center; gap:8px;">
    <button id="prevPage"
            onclick="changePage(-1)"
            style="padding:6px 12px; border-radius:6px; border:1px solid #cbd5e1; cursor:pointer;">
      ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    </button>

    <span id="pageInfo">‡∏´‡∏ô‡πâ‡∏≤ 1 ‡∏à‡∏≤‡∏Å 1</span>

    <button id="nextPage"
            onclick="changePage(1)"
            style="padding:6px 12px; border-radius:6px; border:1px solid #cbd5e1; cursor:pointer;">
      ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
    </button>
  </div>

  <script>
    // ‚≠ê ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + ‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤
    let allData = [];
    let electricData = [];
    let filteredRows = [];
    let currentPage = 1;
    const pageSize = 20;

    async function loadData(){
      const res = await fetch('/data-completed?_=' + Date.now());
      const data = await res.json();
      allData = Array.isArray(data) ? data : [];
      electricData = allData.filter(r => (r.department || '') === '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤');
      applyFilters();
    }

    function applyFilters(){
      const kw = document.getElementById('searchInput').value.trim().toLowerCase();
      filteredRows = electricData.filter(r=>{
        const name=(r.name||'').toLowerCase();
        const phone=(r.phone||'').toLowerCase();
        return !kw || name.includes(kw) || phone.includes(kw);
      });
      currentPage = 1;
      renderCurrentPage();
    }

    function renderCurrentPage() {
      const totalItems = filteredRows.length;
      const totalPages = Math.max(1, Math.ceil(totalItems / pageSize));
      if (currentPage > totalPages) currentPage = totalPages;

      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageData = filteredRows.slice(start, end);

      renderTable(pageData);

      const info = document.getElementById('pageInfo');
      if (info) {
        info.textContent = `‡∏´‡∏ô‡πâ‡∏≤ ${currentPage} ‡∏à‡∏≤‡∏Å ${totalPages} (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
      }

      const prevBtn = document.getElementById('prevPage');
      const nextBtn = document.getElementById('nextPage');
      if (prevBtn) prevBtn.disabled = currentPage === 1;
      if (nextBtn) nextBtn.disabled = currentPage === totalPages;
    }

    function changePage(delta) {
      currentPage += delta;
      renderCurrentPage();
    }

    function renderTable(rows){
      const tbody=document.getElementById('data-body'); 
      tbody.innerHTML='';

      if (!rows || rows.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="9" style="padding:24px;text-align:center;color:#64748b;font-size:15px;">
              ‚úÖ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
            </td>
          </tr>`;
        return;
      }

      rows.forEach(row=>{
        let files=[];
        try{
          if (row.photo && typeof row.photo==='string') files = JSON.parse(row.photo);
          else if (Array.isArray(row.photo)) files = row.photo;
        }catch(e){ files=[]; }

        // --- ‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö‡∏ï‡∏≠‡∏ô ‚Äú‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‚Äù ---
        const completedFiles = files.filter(it=>{
          if(!it || typeof it!=='object') return false;
          return it.from==='completed' || it.tag==='completed';
        });

        // --- ‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà completed) ---
        const mainFiles = files.filter(it=>{
          if(!it) return false;
          if(typeof it!=='object') return true;
          return !(it.from==='completed' || it.tag==='completed');
        });

        // --- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÑ‡∏ü‡∏•‡πå(‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô) ‚Äì ‡πÑ‡∏°‡πà‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏õ, ‡∏°‡∏µ‡πÅ‡∏ï‡πà‡∏õ‡∏∏‡πà‡∏° ---
        let completedLinks = "-";
        if (completedFiles.length > 0) {
          const cf = completedFiles[0];
          const cfUrl = typeof cf === 'string'
            ? (cf.startsWith('uploads/') ? `/${cf}` : cf)
            : (((cf.url || '').startsWith('uploads/')) ? `/${cf.url}` : (cf.url || ''));

          const btnView = `<button class="btn" style="margin-top:6px"
                            onclick='showImages(${JSON.stringify(completedFiles)})'>‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>`;
          const btnAdd  = `<button class="btn" style="margin-top:6px;border-color:#16a34a;color:#16a34a"
                            onclick="openAddFilesModal(${row.original_id || row.id})">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå</button>`;
          const btnDel  = `<button onclick="deleteCompletedFile(${row.original_id || row.id}, '${cfUrl}')"
                            style="margin-top:6px;padding:6px 12px;border:1px solid #dc2626;
                                   background:#fee2e2;color:#b91c1c;border-radius:6px;cursor:pointer;">
                             üóë ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ
                           </button>`;

          completedLinks = `<div class="media-container">${btnView}${btnAdd}${btnDel}</div>`;
        } else {
          const btnAdd  = `<button class="btn" style="margin-top:6px;border-color:#16a34a;color:#16a34a"
                            onclick="openAddFilesModal(${row.original_id || row.id})">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå</button>`;
          completedLinks = `<div class="media-container">${btnAdd}</div>`;
        }

        // --- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å ‚Äì ‡πÑ‡∏°‡πà‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏õ, ‡πÅ‡∏Ñ‡πà‡∏õ‡∏∏‡πà‡∏° "‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ---
        let fileLinks='-';
        if (mainFiles.length>0){
          const btnAll =
            `<button class="btn" style="margin-top:6px"
                     onclick='showImages(${JSON.stringify(mainFiles)})'>‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>`;
          fileLinks = `<div class="media-container">${btnAll}</div>`;
        }

        const mapLink = (row.latitude && row.longitude)
          ? `<a class="map-link" href="https://www.google.com/maps?q=${row.latitude},${row.longitude}" target="_blank">üìç ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a>`
          : '-';

        const statusSelect = `
          <select onchange="setStatus(${row.original_id || row.id}, this.value)">
            <option value="" disabled ${(row.status==null||row.status==='')?'selected':''}>‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
            <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${row.status==='‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'?'selected':''}>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
            <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${row.status==='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'?'selected':''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
            <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ${row.status==='‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'?'selected':''}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
          </select>`;

        tbody.innerHTML += `
          <tr>
            <td>${row.name||'-'}</td>
            <td>${row.phone||'-'}</td>
            <td>${row.message||'-'}</td>
            <td>${fileLinks}</td>
            <td>${row.department||'-'}</td>
            <td>${statusSelect}</td>
            <td>${mapLink}</td>
            <td>${formatDate(row.created_at)}</td>
            <td>${completedLinks}</td>
          </tr>`;
      });
    }

    function formatDate(s){
      if(!s) return '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏ß‡∏•‡∏≤';
      const d=new Date(s);
      if(isNaN(d)) return '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ';
      return d.toLocaleString('th-TH',{
        year:'numeric',month:'2-digit',day:'2-digit',
        hour:'2-digit',minute:'2-digit',second:'2-digit',
        hour12:false
      });
    }

    function showImages(images){
      const html = images.map(img=>{
        const url = typeof img==='string'
          ? (img.startsWith('uploads/')?`/${img}`:img)
          : ((img.url||'').startsWith('uploads/')?`/${img.url}`:(img.url||''));
        const type = (typeof img==='string')?'':(img.type||'');
        if (type==='video' || /\.(mp4|mov|avi)(\?|$)/i.test((url||'').toLowerCase())){
          return `<video controls style="width:auto;max-width:700px;max-height:500px;margin-bottom:20px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.2);">
                    <source src="${url}" type="video/mp4">
                  </video>`;
        }
        return `<img src="${url}" style="width:auto;max-width:700px;max-height:500px;margin-bottom:20px;border-radius:8px;object-fit:contain;box-shadow:0 2px 6px rgba(0,0,0,.2);" />`;
      }).join('');
      const win = window.open('','_blank','width=800,height=600');
      win.document.write(`<body style="font-family:kanit;padding:30px;text-align:center;background:#f9f9f9">${html}</body>`);
    }

    function setStatus(id,status){
      fetch(`/set-status/${id}`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({status})
      })
      .then(res=>{
        if(res.ok){
          alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
          loadData();
        } else {
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï');
        }
      })
      .catch(()=>alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï'));
    }

    loadData();
  </script>

  <script>
    async function deleteCompletedFile(id, fileUrl) {
      if (!confirm('‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ?')) return;
      try {
        const res = await fetch(`/delete-completed-file/${id}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ fileUrl })
        });
        const data = await res.json();
        alert(data.message || '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß');
        if (data.success) {
          if (typeof loadData === 'function') await loadData();
        }
      } catch (err) {
        console.error(err);
        alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå');
      }
    }
  </script>

  <!-- üß© Modal: ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå(‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô) ‡πÄ‡∏û‡∏¥‡πà‡∏° -->
  <div id="addFilesModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.4); z-index:9999; align-items:center; justify-content:center;">
    <div style="background:#fff; width:95%; max-width:520px; border-radius:14px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.2);">
      <h3 style="margin:0 0 8px">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ/‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (‡πÑ‡∏ü‡∏•‡πå ‚Äú‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‚Äù)</h3>
      <p style="margin:0 0 12px; color:#555">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ/‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‚Äú‡πÑ‡∏ü‡∏•‡πå(‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô)‚Äù</p>
      <input id="addFilesInput" type="file" multiple accept="image/*,video/*" style="display:block; margin-bottom:14px">
      <div style="display:flex; gap:8px; justify-content:flex-end">
        <button class="btn" onclick="closeAddFilesModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button id="btnAddFilesUpload" class="btn" style="border-color:#15563b;background:#15563b;color:#fff" onclick="submitAddFiles()">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
      </div>
    </div>
  </div>

  <script>
    let addFilesTargetId = null;

    function openAddFilesModal(id){
      addFilesTargetId = id;
      document.getElementById('addFilesModal').style.display = 'flex';
    }
    function closeAddFilesModal(){
      document.getElementById('addFilesModal').style.display = 'none';
      document.getElementById('addFilesInput').value = '';
      addFilesTargetId = null;
    }

    async function submitAddFiles(){
      if (!addFilesTargetId) return;
      const btn = document.getElementById('btnAddFilesUpload');
      btn.disabled = true; 
      btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...';

      try{
        const fd = new FormData();
        const files = document.getElementById('addFilesInput').files;
        if (!files || files.length === 0){
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô');
          btn.disabled = false; 
          btn.textContent = '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î';
          return;
        }
        for (const f of files) fd.append('extraFiles', f);

        const res = await fetch(`/complete-with-media/${addFilesTargetId}`, { method: 'POST', body: fd });
        const data = await res.json().catch(()=>({}));
        if (!res.ok || data.success === false){
          alert(data.message || '‚ùå ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        } else {
          alert('‚úÖ ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå ‚Äú‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‚Äù ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
          if (typeof loadData === 'function') await loadData();
        }
      }catch(err){
        console.error(err);
        alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î');
      }finally{
        btn.disabled = false; 
        btn.textContent = '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î';
        closeAddFilesModal();
      }
    }
  </script>

</body>
</html>
